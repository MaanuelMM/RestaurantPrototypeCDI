{% extends "base.html" %}

{% block content %}

<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" role="navigation" id="main-navbar">
    <div class="container-fluid">
        <a href="/waiter/tables/list.html" class="mt-auto mb-auto btn btn-warning my-2 my-sm-0">
            <h5>Atrás</h5>
        </a>
        <p class="display-4 text-white">{{ title }}</p>
        <a class="mt-auto navbar-brand my-2 my-sm-0">
            <img src="/static/favicon.svg" alt="logo" style="width:64px">
        </a>
    </div>
</nav>

<div class="container-fluid">
    <a href="/waiter/tables/{{ num }}/info.html" class="mt-auto mb-4 btn btn-warning btn-block">Actualizar</a>
</div>

{% for order_id, order in orders.items() %}
{% if order.table_id == num and order.bill_requested and not order.paid %}
<div class="container-fluid">
    <div class="alert alert-warning">
        <div class="row">
            <div class="col-xl-9" style="margin-bottom:8px;margin-top:8px;">
                <strong>¡Cuenta pedida!</strong> Se ha solicitado la cuenta para el pedido #{{ order_id }}, cuyo pago se
                realizará con <strong>{% if order.pay_by_card %}TARJETA{% else %}EFECTIVO{% endif %}</strong>.
                {% if order.invoice %}Además,
                se ha solicitado <strong>FACTURA</strong>.{% endif %}
            </div>
            <div class="col-xl-3">
                <form action="/waiter/tables/{{ num }}/info.html" method="POST" style="height: 100%;">
                    <input type="hidden" name="order-id" value="{{ order_id }}">
                    <input type="hidden" name="paid" value="True">
                    <button type="submit" class="btn btn-warning btn-block" style="height: 100%;">Pagado</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endfor %}

<div class="container-fluid">
    <div class="row">
        {% for state_item, state in states.items() %}
        <div class="col-xl-3">
            <div class="card" style="margin:8px">
                <div class="d-flex flex-column card-body bg-light text-dark">
                    <h3 class="text-center" style="margin-bottom:16px;">{{ state.name }}</h3>
                    {% for order_id, order in orders.items() %}
                    {% if order.table_id == num and not order.paid %}
                    {% for order_record_id, order_record in orders_record.items() %}
                    {% if order_record.order_id == order_id and order_record.state == state_item %}
                    <div class="card mb-3">
                        <div class="row no-gutters">
                            <div class="m-auto col-md-4">
                                <img src="{{ products[order_record.product_id]['pathImage'] }}" class="card-img"
                                    alt="{{ products[order_record.product_id]['name'] }}" style="cursor:pointer"
                                    onclick="onClick(this)">
                            </div>
                            <div class="m-auto col-md-8">
                                <div class="card-body">
                                    <h5 class="card-title">{{ products[order_record.product_id]['name'] }}</h5>
                                    <p class="card-text"><small class="text-muted">Pedido #{{ order_id }} | Orden
                                            #{{ order_record_id }}</small>
                                    </p>
                                </div>
                            </div>
                            {% if state_item == "pending" or state_item == "ear_kitchen" %}
                            <div class="pb-3 container-fluid">
                                <div class="row">
                                    <div class="col-sm" style="margin-top:8px;margin-bottom:8px;">
                                        <form action="/waiter/tables/{{ num }}/info.html" method="POST" class="m-auto">
                                            <input type="hidden" name="record-id" value="{{ order_record_id }}">
                                            <input type="hidden" name="state" value="cancelled">
                                            <button type="submit" class="btn btn-danger btn-block">Cancelar</button>
                                        </form>
                                    </div>
                                    <div class="col-sm" style="margin-top:8px;margin-bottom:8px;">
                                        <form action="/waiter/tables/{{ num }}/info.html" method="POST" class="m-auto">
                                            <input type="hidden" name="record-id" value="{{ order_record_id }}">
                                            <input type="hidden" name="state"
                                                value="{% if state_item == 'pending' %}ear_kitchen{% else %}delivered{% endif %}">
                                            <button type="submit"
                                                class="btn btn-success btn-block">{% if state_item == "pending" %}Aceptar{% else %}Entregar{% endif %}</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                    {% endfor %}
                    {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

{% endblock %}